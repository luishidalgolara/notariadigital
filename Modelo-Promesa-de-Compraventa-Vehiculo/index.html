<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notar√≠a Digital - Promesa de Compraventa de Veh√≠culo</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Bot√≥n Toggle Tema -->
    <div class="theme-toggle" id="themeToggle">
        <span class="theme-icon dark-icon">üåô</span>
        <span class="theme-icon light-icon">‚òÄÔ∏è</span>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-text">
                        <h1>Notar√≠a Digital</h1>
                        <p>Sistema Profesional de Documentos Legales</p>
                    </div>
                </div>
                <div class="header-info">
                    <span class="document-type">Promesa de Compraventa de Veh√≠culo</span>
                </div>
            </div>
        </div>
        
        <!-- Barra de Progreso -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text">
                <span id="progressText">Completado: 0%</span>
            </div>
        </div>
        
        <!-- Contenido Principal -->
        <div class="main-content">
            <!-- Secci√≥n del Formulario -->
            <div class="form-section">
                <div class="form-container">
                    <!-- DATOS DEL LUGAR Y FECHA -->
                    <div class="section-card">
                        <div class="section-header">
                            <div class="section-icon">üìÖ</div>
                            <h2 class="section-title">Lugar y Fecha del Contrato</h2>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Ciudad</label>
                                <input type="text" id="ciudadContrato" placeholder="Ej: Santiago">
                            </div>
                            <div class="form-group">
                                <label>Fecha del Contrato</label>
                                <input type="date" id="fechaContrato">
                            </div>
                        </div>
                    </div>
                    
                    <!-- DATOS DEL PROMITENTE VENDEDOR -->
                    <div class="section-card">
                        <div class="section-header">
                            <div class="section-icon">üë§</div>
                            <h2 class="section-title">Datos del Promitente Vendedor</h2>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Nombre Completo</label>
                                <input type="text" id="nombreVendedor" placeholder="Ej: Juan Carlos P√©rez Garc√≠a">
                            </div>
                            <div class="form-group">
                                <label>C.I. (RUT)</label>
                                <input type="text" id="rutVendedor" placeholder="Ej: 12.345.678-9">
                            </div>
                            <div class="form-group span-2">
                                <label>Domicilio</label>
                                <input type="text" id="domicilioVendedor" placeholder="Ej: Av. Providencia 1234">
                            </div>
                            <div class="form-group">
                                <label>Comuna</label>
                                <input type="text" id="comunaVendedor" placeholder="Ej: Providencia">
                            </div>
                            <div class="form-group">
                                <label>Ciudad</label>
                                <input type="text" id="ciudadVendedor" placeholder="Ej: Santiago">
                            </div>
                            <div class="form-group span-2">
                                <div class="button-group">
                                    <button class="btn-digital-signature half-width" id="firmaVendedor">
                                        <span class="signature-icon">‚úçÔ∏è</span>
                                        <span class="signature-text">FIRMA DIGITAL</span>
                                    </button>
                                    <button class="btn-photo-carnet half-width" id="photoVendedor">
                                        <span class="photo-icon">üì∑</span>
                                        <span class="photo-text">FOTO CARNET</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- DATOS DEL PROMITENTE COMPRADOR -->
                    <div class="section-card">
                        <div class="section-header">
                            <div class="section-icon">ü§ù</div>
                            <h2 class="section-title">Datos del Promitente Comprador</h2>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Nombre Completo</label>
                                <input type="text" id="nombreComprador" placeholder="Ej: Mar√≠a Elena Gonz√°lez L√≥pez">
                            </div>
                            <div class="form-group">
                                <label>C.I. (RUT)</label>
                                <input type="text" id="rutComprador" placeholder="Ej: 23.456.789-0">
                            </div>
                            <div class="form-group span-2">
                                <label>Domicilio</label>
                                <input type="text" id="domicilioComprador" placeholder="Ej: Las Condes 5678">
                            </div>
                            <div class="form-group">
                                <label>Comuna</label>
                                <input type="text" id="comunaComprador" placeholder="Ej: Las Condes">
                            </div>
                            <div class="form-group">
                                <label>Ciudad</label>
                                <input type="text" id="ciudadComprador" placeholder="Ej: Santiago">
                            </div>
                            <div class="form-group span-2">
                                <div class="button-group">
                                    <button class="btn-digital-signature half-width" id="firmaComprador">
                                        <span class="signature-icon">‚úçÔ∏è</span>
                                        <span class="signature-text">FIRMA DIGITAL</span>
                                    </button>
                                    <button class="btn-photo-carnet half-width" id="photoComprador">
                                        <span class="photo-icon">üì∑</span>
                                        <span class="photo-text">FOTO CARNET</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- DATOS DEL VEH√çCULO -->
                    <div class="section-card">
                        <div class="section-header">
                            <div class="section-icon">üöó</div>
                            <h2 class="section-title">Datos del Veh√≠culo</h2>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Tipo de Veh√≠culo</label>
                                <select id="tipoVehiculo">
                                    <option value="">Seleccionar tipo</option>
                                    <option value="Autom√≥vil">Autom√≥vil</option>
                                    <option value="Station Wagon">Station Wagon</option>
                                    <option value="Hatchback">Hatchback</option>
                                    <option value="Sed√°n">Sed√°n</option>
                                    <option value="SUV">SUV</option>
                                    <option value="Pick-up">Pick-up</option>
                                    <option value="Camioneta">Camioneta</option>
                                    <option value="Furg√≥n">Furg√≥n</option>
                                    <option value="Bus">Bus</option>
                                    <option value="Cami√≥n">Cami√≥n</option>
                                    <option value="Motocicleta">Motocicleta</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Marca</label>
                                <select id="marcaVehiculo">
                                    <option value="">Seleccionar marca</option>
                                    <option value="Toyota">Toyota</option>
                                    <option value="Chevrolet">Chevrolet</option>
                                    <option value="Nissan">Nissan</option>
                                    <option value="Hyundai">Hyundai</option>
                                    <option value="Kia">Kia</option>
                                    <option value="Mazda">Mazda</option>
                                    <option value="Suzuki">Suzuki</option>
                                    <option value="Ford">Ford</option>
                                    <option value="Volkswagen">Volkswagen</option>
                                    <option value="Peugeot">Peugeot</option>
                                    <option value="Renault">Renault</option>
                                    <option value="Citro√´n">Citro√´n</option>
                                    <option value="Fiat">Fiat</option>
                                    <option value="Honda">Honda</option>
                                    <option value="Mitsubishi">Mitsubishi</option>
                                    <option value="Subaru">Subaru</option>
                                    <option value="BMW">BMW</option>
                                    <option value="Mercedes-Benz">Mercedes-Benz</option>
                                    <option value="Audi">Audi</option>
                                    <option value="Otra">Otra</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Modelo</label>
                                <input type="text" id="modeloVehiculo" placeholder="Ej: Corolla">
                            </div>
                            <div class="form-group">
                                <label>A√±o</label>
                                <input type="number" id="anoVehiculo" min="1990" max="2024" placeholder="Ej: 2020">
                            </div>
                            <div class="form-group">
                                <label>Patente</label>
                                <input type="text" id="patenteVehiculo" placeholder="Ej: AA-12-34 o AAAA-12">
                            </div>
                            <div class="form-group">
                                <label>Color</label>
                                <select id="colorVehiculo">
                                    <option value="">Seleccionar color</option>
                                    <option value="Blanco">Blanco</option>
                                    <option value="Negro">Negro</option>
                                    <option value="Gris">Gris</option>
                                    <option value="Plata">Plata</option>
                                    <option value="Azul">Azul</option>
                                    <option value="Rojo">Rojo</option>
                                    <option value="Verde">Verde</option>
                                    <option value="Amarillo">Amarillo</option>
                                    <option value="Caf√©">Caf√©</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>N√∫mero de Motor</label>
                                <input type="text" id="numeroMotor" placeholder="Ej: 4A-FE1234567">
                            </div>
                            <div class="form-group">
                                <label>N√∫mero de Chasis</label>
                                <input type="text" id="numeroChasis" placeholder="Ej: JTDBT903301234567">
                            </div>
                        </div>
                    </div>
                    
                    <!-- CONDICIONES DE LA VENTA -->
                    <div class="section-card">
                        <div class="section-header">
                            <div class="section-icon">üí∞</div>
                            <h2 class="section-title">Condiciones de la Venta</h2>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Precio de Venta</label>
                                <input type="number" id="precioVenta" min="100000" max="999999999" placeholder="Ej: 8500000">
                            </div>
                            <div class="form-group">
                                <label>Fecha de Entrega</label>
                                <input type="date" id="fechaEntrega">
                            </div>
                            <div class="form-group span-2">
                                <label>Forma de Pago</label>
                                <textarea id="formaPago" rows="3" placeholder="Describa la forma de pago acordada. Ej: Contado total al momento de la entrega, 30% pie y saldo financiado, etc."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Fecha de Venta Definitiva</label>
                                <input type="date" id="fechaVentaDefinitiva">
                            </div>
                            <div class="form-group">
                                <label>Condici√≥n Especial</label>
                                <select id="condicionVenta">
                                    <option value="">Seleccionar condici√≥n</option>
                                    <option value="Una vez pagado el precio total">Una vez pagado el precio total</option>
                                    <option value="Una vez obtenido el financiamiento">Una vez obtenido el financiamiento</option>
                                    <option value="Una vez verificado el estado del veh√≠culo">Una vez verificado el estado del veh√≠culo</option>
                                    <option value="Una vez completada la documentaci√≥n">Una vez completada la documentaci√≥n</option>
                                    <option value="Otra condici√≥n">Otra condici√≥n</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Secci√≥n de Vista Previa -->
            <div class="preview-section">
                <div class="preview-container">
                    <div class="preview-header">
                        <div class="preview-icon">üëÅÔ∏è</div>
                        <h2 class="preview-title">Vista Previa del Documento</h2>
                    </div>
                    
                    <div class="document-preview" id="documentPreview">
                        <div class="document-header">
                            <div class="document-title">PROMESA DE COMPRAVENTA</div>
                            <div class="document-subtitle">Veh√≠culo Motorizado</div>
                        </div>
                        
                        <div class="document-content">
                            <p>En <span class="highlight" id="prev_ciudadContrato">.........</span>, a <span class="highlight" id="prev_dia">...</span> de <span class="highlight" id="prev_mes">........</span> de <span class="highlight" id="prev_anio">20..</span>, entre don (do√±a)</p>
                            
                            <br>
                            
                            <p><span class="highlight" id="prev_nombreVendedor">.........................</span>, C.I. N¬∞ <span class="highlight" id="prev_rutVendedor">................</span>, domiciliado(a) en <span class="highlight" id="prev_domicilioVendedor">.........................</span>, comuna de <span class="highlight" id="prev_comunaVendedor">...........</span>, en adelante el <strong>promitente vendedor</strong>; y don (do√±a) <span class="highlight" id="prev_nombreComprador">.........................</span>, C.I. N¬∞ <span class="highlight" id="prev_rutComprador">................</span>, domiciliado(a) en <span class="highlight" id="prev_domicilioComprador">.........................</span>, comuna de <span class="highlight" id="prev_comunaComprador">...........</span>, en adelante el <strong>promitente comprador</strong>. Han convenido en el siguiente contrato de Promesa de Compraventa de Veh√≠culo Motorizado:</p>
                            
                            <br>
                            
                            <p><strong>PRIMERO:</strong> Don(√±a) <span class="highlight" id="prev_nombreVendedor2">...........</span>, declara ser due√±o de un veh√≠culo tipo: <span class="highlight" id="prev_tipoVehiculo">...........</span>; marca: <span class="highlight" id="prev_marcaVehiculo">...........</span>; modelo: <span class="highlight" id="prev_modeloVehiculo">...........</span>; N¬∞ motor: <span class="highlight" id="prev_numeroMotor">...........</span>; N¬∞ chasis: <span class="highlight" id="prev_numeroChasis">...........</span>; color: <span class="highlight" id="prev_colorVehiculo">...........</span>; a√±o: <span class="highlight" id="prev_anoVehiculo">...........</span>; Patente e Inscripci√≥n: <span class="highlight" id="prev_patenteVehiculo">...........</span></p>
                            
                            <p><strong>SEGUNDO:</strong> Por el presente instrumento don(√±a) <span class="highlight" id="prev_nombreVendedor3">...........</span>, promete vender, ceder y transferir a don(√±a) <span class="highlight" id="prev_nombreComprador2">...........</span>, quien promete comprar, aceptar y adquirir para s√≠, el veh√≠culo antes singularizado.</p>
                            
                            <p><strong>TERCERO:</strong> El precio de la venta es la suma de $ <span class="highlight" id="prev_precioVenta">...........</span> (<span class="highlight" id="prev_precioVentaPalabras">.........................</span>), los que se pagan de la siguiente manera: <span class="highlight" id="prev_formaPago">........................................................................................</span></p>
                            
                            <p><strong>CUARTO:</strong> El veh√≠culo se promete vender en el estado en que actualmente se encuentra, que es conocido del promitente comprador, con todos sus accesorios, con sus derechos, respondiendo el promitente vendedor por el saneamiento conforme a la ley.</p>
                            
                            <p><strong>QUINTO:</strong> La entrega del veh√≠culo y sus llaves, se hace con fecha <span class="highlight" id="prev_fechaEntrega">........................</span>, recibiendo el promitente comprador a entera satisfacci√≥n.</p>
                            
                            <p><strong>SEXTO:</strong> La venta definitiva se efectuar√° el d√≠a <span class="highlight" id="prev_fechaVentaDefinitiva">........................</span>, una vez <span class="highlight" id="prev_condicionVenta">........................</span></p>
                            
                            <p><strong>S√âPTIMO:</strong> El promitente vendedor asume la obligaci√≥n de no vender, ceder, prendar, permutar, arrendar, dar en pago ni ejecutar acto jur√≠dico de ninguna naturaleza sobre el referido bien, a menos que el promitente comprador lo autorice por escrito.</p>
                            
                            <p><strong>OCTAVO:</strong> Para todos los efectos legales que puedan derivar del presente contrato las partes fijan su domicilio en <span class="highlight" id="prev_ciudadContrato2">...........</span> y se someten a la Jurisdicci√≥n de sus Tribunales de Justicia.</p>
                            
                            <br><br><br>
                            
                            <div class="signature-section">
                                <div class="signature-box">
                                    <div class="signature-line">
                                        <span class="signature-placeholder" id="signaturePlaceholderVendedor">Firma Digital</span>
                                        <img class="signature-preview" id="signaturePreviewVendedor" style="display: none; max-width: 100%; max-height: 50px; object-fit: contain;" alt="Firma Vendedor">
                                    </div>
                                    <div class="signature-name" id="prev_firmaVendedor">_______________</div>
                                    <div class="signature-role">PROMITENTE VENDEDOR</div>
                                </div>
                                
                                <div class="signature-box">
                                    <div class="signature-line">
                                        <span class="signature-placeholder" id="signaturePlaceholderComprador">Firma Digital</span>
                                        <img class="signature-preview" id="signaturePreviewComprador" style="display: none; max-width: 100%; max-height: 50px; object-fit: contain;" alt="Firma Comprador">
                                    </div>
                                    <div class="signature-name" id="prev_firmaComprador">_______________</div>
                                    <div class="signature-role">PROMITENTE COMPRADOR</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Botones de Acci√≥n -->
        <div class="actions">
            <button class="btn btn-secondary" onclick="window.location.href='../tramites-virtuales.html'">
                <span class="btn-icon">‚Üê</span>
                <span class="btn-text">Volver a Tr√°mites</span>
            </button>
            <button class="btn btn-secondary" onclick="clearForm()">
                <span class="btn-icon">üóëÔ∏è</span>
                <span class="btn-text">Limpiar Formulario</span>
            </button>
            <button class="btn btn-primary" onclick="generatePDF()">
                <span class="btn-icon">üìÑ</span>
                <span class="btn-text">Generar PDF con Firmas Digitales</span>
            </button>
        </div>
    </div>

    <!-- MODAL PROCESADOR DE FIRMAS DIGITALES -->
    <div class="firma-modal-overlay" id="firmaModalOverlay">
        <div class="firma-modal-container">
            <div class="firma-modal-header">
                <div class="firma-modal-title">
                    <div class="firma-modal-icon">‚úçÔ∏è</div>
                    <div class="firma-modal-text">
                        <h2>Procesador de Firmas Digitales</h2>
                        <p>Convierte tu firma en papel a digital transparente</p>
                    </div>
                </div>
                <button class="firma-modal-close" id="firmaModalClose">
                    <span>‚úï</span>
                </button>
            </div>

            <div class="firma-modal-content">
                <div class="firma-alert" id="firmaAlert" style="display: none;"></div>
                
                <div class="firma-upload-area" id="firmaUploadArea">
                    <div class="firma-upload-icon">üì∏</div>
                    <h3>Sube tu firma escaneada</h3>
                    <p>Arrastra tu firma aqu√≠ o haz clic para seleccionar</p>
                    <button class="firma-btn firma-btn-primary" onclick="document.getElementById('firmaFileInput').click()">
                        <span>üìÅ</span>
                        <span>Seleccionar Imagen</span>
                    </button>
                    <input type="file" id="firmaFileInput" accept="image/*" style="display: none;">
                </div>

                <div class="firma-loading" id="firmaLoading">
                    <div class="firma-spinner"></div>
                    <p>Procesando tu firma...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL FOTO CARNET DOBLE -->
    <div class="photo-modal-overlay" id="photoModalOverlay">
        <div class="photo-modal-container">
            <div class="photo-modal-header">
                <div class="photo-modal-title">
                    <div class="photo-modal-icon">üì∑</div>
                    <div class="photo-modal-text">
                        <h2>Captura de Carnet Completo</h2>
                        <p>Fotograf√≠e ambos lados de su carnet de identidad</p>
                    </div>
                </div>
                <button class="photo-modal-close" id="photoModalClose">
                    <span>‚úï</span>
                </button>
            </div>

            <div class="photo-modal-content">
                <!-- Indicador de Progreso -->
                <div class="photo-progress" id="photoProgress">
                    <div class="photo-step" id="stepFrente">
                        <div class="photo-step-icon">üìÑ</div>
                        <div class="photo-step-text">Frente</div>
                    </div>
                    <div class="photo-arrow">‚Üí</div>
                    <div class="photo-step pending" id="stepReverso">
                        <div class="photo-step-icon">üìÑ</div>
                        <div class="photo-step-text">Reverso</div>
                    </div>
                </div>

                <!-- Loading State -->
                <div class="photo-loading" id="photoLoading">
                    <div class="spinner"></div>
                    <h3>Iniciando c√°mara...</h3>
                    <p>Solicitando permisos de acceso a la c√°mara</p>
                </div>

                <!-- Camera View -->
                <div class="camera-container" id="cameraContainer" style="display: none;">
                    <div class="photo-status" id="photoStatus">
                        <h3>Posicione el frente de su carnet en el recuadro</h3>
                        <p>Aseg√∫rese de que el carnet est√© bien iluminado y sea legible</p>
                    </div>
                    
                    <div class="camera-view">
                        <video class="camera-video" id="cameraVideo" autoplay playsinline></video>
                        <div class="camera-overlay frente" id="cameraOverlay"></div>
                        <canvas id="captureCanvas" style="display: none;"></canvas>
                    </div>

                    <div class="camera-controls">
                        <button class="photo-btn photo-btn-capture" id="captureBtn">
                            <span>üì∏</span>
                            <span>Capturar Foto</span>
                        </button>
                    </div>
                </div>

                <!-- Photo Preview -->
                <div class="camera-container" id="previewContainer" style="display: none;">
                    <div class="photo-status" id="previewStatus">
                        <h3>Vista previa del frente</h3>
                        <p>Revise que la imagen sea clara y legible</p>
                    </div>
                    
                    <img class="photo-preview" id="photoPreview" alt="Vista previa de la foto del carnet">

                    <div class="camera-controls">
                        <button class="photo-btn photo-btn-retry" id="retryBtn">
                            <span>üîÑ</span>
                            <span>Tomar Otra</span>
                        </button>
                        <button class="photo-btn photo-btn-next" id="nextBtn">
                            <span>‚û°Ô∏è</span>
                            <span>Siguiente Paso</span>
                        </button>
                    </div>
                </div>

                <!-- Photos Summary -->
                <div class="photos-summary" id="photosSummary" style="display: none;">
                    <div class="photo-status">
                        <h3>Ambas fotos capturadas correctamente</h3>
                        <p>Revise las im√°genes antes de confirmar</p>
                    </div>
                    
                    <div class="photos-grid">
                        <div class="photo-card">
                            <h4>üìÑ Frente del Carnet</h4>
                            <img id="summaryFrente" alt="Frente del carnet">
                        </div>
                        <div class="photo-card">
                            <h4>üìÑ Reverso del Carnet</h4>
                            <img id="summaryReverso" alt="Reverso del carnet">
                        </div>
                    </div>

                    <div class="camera-controls">
                        <button class="photo-btn photo-btn-retry" id="restartBtn">
                            <span>üîÑ</span>
                            <span>Reiniciar Todo</span>
                        </button>
                        <button class="photo-btn photo-btn-confirm" id="confirmAllBtn">
                            <span>‚úÖ</span>
                            <span>Confirmar Ambas Fotos</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS - ORDEN CORRECTO PARA EVITAR CONDICIONES DE CARRERA -->
    <!-- 1. Cargar jsPDF PRIMERO (cr√≠tico para PDF) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- 2. Cargar configuraci√≥n (requerida por script principal) -->
    <script src="config.js"></script>
    
    <!-- 3. Cargar script principal (depende de config y jsPDF) -->
    <script src="script.js"></script>
    
    <!-- 4. Cargar verificaci√≥n facial (auto-contenido, se inicializa solo) -->
    <script src="face-verification.js"></script>

    <!-- SCRIPT DE VERIFICACI√ìN DE CARGA FINAL -->
    <script>
        // Toggle del tema
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('themeToggle');
            const body = document.body;
            
            // Cargar tema guardado
            const savedTheme = localStorage.getItem('theme') || 'dark';
            body.setAttribute('data-theme', savedTheme);
            
            // Toggle del tema
            themeToggle.addEventListener('click', function() {
                const currentTheme = body.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                body.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                // Efecto de transici√≥n
                body.classList.add('theme-transition');
                setTimeout(() => {
                    body.classList.remove('theme-transition');
                }, 300);
            });
        });

        // Verificaci√≥n final para asegurar que todo se carg√≥ correctamente
        window.addEventListener('load', function() {
            setTimeout(function() {
                // Verificar elementos cr√≠ticos despu√©s de carga completa
                const criticalElements = [
                    'firmaModalOverlay', 'photoModalOverlay', 
                    'firmaVendedor', 'firmaComprador',
                    'photoVendedor', 'photoComprador',
                    'progressFill', 'progressText'
                ];
                
                const missingElements = criticalElements.filter(id => !document.getElementById(id));
                
                if (missingElements.length > 0) {
                    console.error('‚ùå Elementos cr√≠ticos faltantes despu√©s de carga completa:', missingElements);
                    
                    // Intentar recargar sistemas si faltan elementos
                    if (window.promesaSystem && typeof window.promesaSystem.handleInitializationError === 'function') {
                        console.log('üîÑ Activando recuperaci√≥n autom√°tica...');
                        window.promesaSystem.handleInitializationError(new Error('Elementos cr√≠ticos faltantes'));
                    }
                } else {
                    console.log('‚úÖ Todos los elementos cr√≠ticos verificados despu√©s de carga completa');
                }
                
                // Verificar que los sistemas est√©n funcionando
                const systemChecks = {
                    promesaSystem: !!window.promesaSystem,
                    firmaProcessor: !!window.firmaProcessor,
                    photoProcessor: !!window.photoProcessor,
                    faceVerification: !!window.faceVerificationSystem,
                    jsPDF: !!window.jspdf,
                    CONFIG: !!window.CONFIG
                };
                
                console.log('üîç Estado de sistemas:', systemChecks);
                
                // Si alg√∫n sistema cr√≠tico falla, mostrar advertencia
                if (!systemChecks.promesaSystem || !systemChecks.jsPDF || !systemChecks.CONFIG) {
                    console.warn('‚ö†Ô∏è Sistemas cr√≠ticos no est√°n completamente cargados');
                    
                    // Crear notificaci√≥n de advertencia
                    const warning = document.createElement('div');
                    warning.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: linear-gradient(135deg, #3b82f6, #1e40af);
                        color: white;
                        padding: 15px 25px;
                        border-radius: 12px;
                        z-index: 9999;
                        font-weight: 600;
                        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
                        text-align: center;
                        max-width: 400px;
                    `;
                    warning.innerHTML = '‚ö†Ô∏è Algunos sistemas se est√°n cargando. Si experimenta problemas, recargue la p√°gina.';
                    document.body.appendChild(warning);
                    
                    // Remover advertencia despu√©s de 10 segundos
                    setTimeout(() => {
                        if (warning.parentNode) {
                            warning.parentNode.removeChild(warning);
                        }
                    }, 10000);
                }
            }, 2000); // Verificar 2 segundos despu√©s de carga completa
        });
        
        // Manejar errores de script
        window.addEventListener('error', function(event) {
            console.error('‚ùå Error de script detectado:', event.error);
            
            // Si es un error cr√≠tico, intentar recuperaci√≥n
            if (event.filename && (event.filename.includes('script.js') || event.filename.includes('config.js'))) {
                console.log('üö® Error cr√≠tico detectado, activando modo de recuperaci√≥n...');
                
                setTimeout(() => {
                    if (!window.promesaSystem) {
                        console.log('üîÑ Reintentando inicializaci√≥n del sistema...');
                        // Recargar la p√°gina como √∫ltimo recurso
                        if (confirm('El sistema ha encontrado un error. ¬øDesea recargar la p√°gina para solucionarlo?')) {
                            window.location.reload();
                        }
                    }
                }, 3000);
            }
        });
        
        console.log('üõ°Ô∏è Sistema de verificaci√≥n y recuperaci√≥n activado');
    </script>
</body>
</html>